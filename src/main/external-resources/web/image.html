<!DOCTYPE html>
<html>
	<head>
		{{ > common/head.html }}
	</head>
	<body id="ContentPage">
		<script>
{{#nextId}}
 {{#delay}}
			setTimeout(next, {{delay}});
{{/delay}}
{{/nextId}}
			var img, imgcontainer, zoomed = false;

			function fit(event) {
				var rx = 0, ry = 0;
				zoomed = !zoomed;
 				if (!zoomed) {
					img.addClass('imgfit');
				} else {
					// Get the relative click point
					var pos = img.offset();
					rx = (event.clientX - pos.left) / img.width();
					ry = (event.clientY - pos.top) / img.height();
					img.removeClass('imgfit');
				}
				zoom(rx, ry);
			}

			function zoom(rx, ry) {
				var w = img.prop('naturalWidth'),
					h = img.prop('naturalHeight');
				if (w > img.width() || h > img.height()) {
					img.addClass('zoomin');
					img.removeClass('zoomout');
					window.scrollTo(0, 0);
					imgcontainer.addClass('noScroll');
				} else {
					img.removeClass('zoomin');
					if (w > imgcontainer.width() || h > imgcontainer.height()) {
						imgcontainer.removeClass('noScroll');
						img.addClass('zoomout');
						if (rx || ry) {
							// Center on/near the relative click point
							var pos = img.offset();
							window.scrollTo(pos.left + rx * w - $(window).width() / 2,
								pos.top + ry * h - $(window).height() / 2);
						}
					} else {
						img.removeClass('zoomout');
					}
				}
			}

			function resize(event) {
				if (!img) {
					img = $('#Image');
					imgcontainer = $('#ImageContainer');
				}
				$('body').height($(window).height());
				var top = $('#Menu').height();
				imgcontainer.css({ top: '' + top + 'px' });
				imgcontainer.height($('body').height() - top);
//				if (event.type === 'load') {
					imgcontainer.show();
//				}
				zoom();
			}
			
			$(document).ready(resize);
			$(window).on('resize', resize);
		</script>

		<div id="Container">
			{{ > common/menu.html }}

			<div id="ImageContainer">
				<img id="Image" class="imgfit" src="{{url}}" alt="" onclick="fit(event)"><br>
			</div>
			<div id="ImageToolbar">
				<button id="prev" onclick="prev()"{{prevAttr}}><<</button>
				<button id="next" onclick="next()"{{nextAttr}}>>></button>
			</div>
		</div>
	</body>
</html>

